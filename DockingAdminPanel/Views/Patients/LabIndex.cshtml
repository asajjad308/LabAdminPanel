@model IEnumerable<DockingAdminPanel.Models.Patient>

@{
    ViewData["Title"] = "Index";
}

<link rel="stylesheet" href="https://cdn.datatables.net/1.13.6/css/jquery.dataTables.css" />

<script src="https://cdn.datatables.net/1.13.6/js/jquery.dataTables.js"></script>

<div class="card mt-5">

    <div class="card-header">


        <a class="btn btn-primary btn-block float-start" asp-action="CreateLab"><i class='bx bx-add-to-queue bx-tada bx-flip-vertical '></i>Add Patients</a>
    </div>
    <div class="card-body">
        <div class="table-responsive">
            <table id="myTable" class="display">
                <thead>
                    <tr>
                        <th>Status</th>
                        <th>
                            Token Number
                        </th>
                        <th>Type</th>
                        <th>
                            Name
                        </th>
                        <th>
                            @Html.DisplayNameFor(model => model.Sex)
                        </th>

                        <th>
                            @Html.DisplayNameFor(model => model.Age)
                        </th>
                        <th>
                            @Html.DisplayNameFor(model => model.PhoneNumber)
                        </th>

                        <th>
                            @Html.DisplayNameFor(model => model.Address)
                        </th>
            
                        <th>
                            @Html.DisplayNameFor(model => model.Illness)
                        </th>
                        <th></th>
                    </tr>
                </thead>
                <tbody>
                    @foreach (var item in Model)
                    {
                        <tr data-fullname="@item.FullName" data-fee="@item.Fee" data-token="@item.TokenNumber">
                            <td style=@(item.PaymentStatus==true?"background-color:green":"background-color:red")>
                                @(item.PaymentStatus == true ? "Paid" : "UnPaid")
                            </td>
                            <td>
                                @Html.DisplayFor(modelItem => item.TokenNumber)
                            </td>
                            <td>
                                @Html.DisplayFor(modelItem => item.LabAppointment)
                            </td>
                            <td>
                                @Html.DisplayFor(modelItem => item.FirstName)
                            </td>
                            <td>
                                @Html.DisplayFor(modelItem => item.Sex)
                            </td>
                            <td>
                                @Html.DisplayFor(modelItem => item.Age)
                            </td>
                            <td>
                                @Html.DisplayFor(modelItem => item.PhoneNumber)
                            </td>

                            <td>
                                @Html.DisplayFor(modelItem => item.Address)
                            </td>


                            <td>
                                @Html.DisplayFor(modelItem => item.Illness)
                            </td>

                            <td>
                                <a onclick="printReceipt('@item')" class="btn btn-success" style="background-color:#fcbf49">Pay</a>
                                <a asp-action="AddTestsAppointments" class="btn btn-outline-primary" asp-route-id="@item.Id">Add Tests</a> |
                                <a asp-action="Edit" class="btn btn-outline-secondary" asp-route-id="@item.Id">Edit</a> |
                                <a asp-action="Details" class="btn btn-outline-warning" asp-route-id="@item.Id">Details</a> |
                                <a asp-action="Delete" class="btn btn-outline-danger" asp-route-id="@item.Id">Delete</a>


                            </td>
                        </tr>
                    }
                </tbody>
            </table>
        </div>
    </div>
</div>





<script>


    function printReceipt(item) {
        var tr = findClosestTableRow(item); // Find the parent tr element
        if (!tr) {
            console.error("Could not find the closest table row.");
            return;
        }
        //var tr = element.closest('tr'); // Find the parent tr element
        var fullname = tr.getAttribute('data-fullname');
        var fee = tr.getAttribute('data-fee');
        var token = tr.getAttribute('data-token');



        var printContent = `

                <style type="text/css">
            #invoice-POS{
               font-family: Arial, sans-serif;
          padding:0mm;
          margin: 0 auto;
          width: 88mm;
          background: #FFF;


        ::selection {background: #f31544; color: #FFF;}
        ::moz-selection {background: #f31544; color: #FFF;}
        h1{
          font-size: 1.5em;
          color: #222;
        }
        h2{font-size: .9em;}
        h3{
          font-size: 1.2em;
          font-weight: 300;
          line-height: 2em;
        }
        p{
          font-size: .7em;
          color: #666;
          line-height: 1.2em;
        }

        #top, #mid,#bot{ /* Targets all id with 'col-' */
          border-bottom: 1px solid #EEE;
        }

        #top{min-height: 100px;}
        #mid{min-height: 80px;}
        #bot{ min-height: 50px;}

        #top .logo{
          //float: left;
            height: 60px;
            width: 60px;
            background: url(http://michaeltruong.ca/images/logo1.png) no-repeat;
            background-size: 60px 60px;
        }
        .clientlogo{
          float: left;
            height: 60px;
            width: 60px;
            background: url(http://michaeltruong.ca/images/client.jpg) no-repeat;
            background-size: 60px 60px;
          border-radius: 50px;
        }
        .info{
          display: block;
          //float:left;
          margin-left: 0;
        }
        .title{
          float: right;
        }
        .title p{text-align: right;}
        table{
          width: 100%;
          border-collapse: collapse;
        }
        td{
          //padding: 5px 0 5px 15px;
          //border: 1px solid #EEE
        }
        .tabletitle{
          //padding: 5px;
          font-size: .5em;
          background: #EEE;
        }
        .service{border-bottom: 1px solid #EEE;}
        .item{width: 24mm;}
        .itemtext{font-size: .5em;}

        #legalcopy{
          margin-top: 5mm;
        }


       

        }
        </style>

        <!-- Header -->

          <div id="invoice-POS">

            <center id="top">
              <div class="logo"></div>
              <div class="info">
                <h2>A+ Clinics</h2>
              </div><!--End Info-->
            </center><!--End InvoiceTop-->

            <div id="mid">
              <div class="info text-center">
                <p>
                    Address : Rajjar charsadda, kpk 24420</br>
                    Email   : ahmad@gmail.com</br>
                    Phone   : 555-555-5555</br>
                </p>
              </div>
            </div><!--End Invoice Mid-->

            <div id="bot">
                <div class="container"> 


                             <div class="row my-2 mx-1 justify-content-center">
          <table class="table table-striped table-borderless information-table">
            <thead style="background-color:#84B0CA ;" class="text-white">
              <tr>
            
                <th scope="col">Description</th>
                <th scope="col">Qty</th>
                <th scope="col">Unit Price</th>
              
              </tr>
            </thead>
            <tbody>
              <tr>
               
                <td>Pro Package</td>
                <td>4</td>
                <td>$200</td>
               
              </tr>
              <tr>
             
                <td>Web hosting</td>
                <td>1</td>
                <td>$10</td>
                
              </tr>
              <tr>
               
                <td>Consulting</td>
                <td>1</td>
                <td>$300</td>
            
              </tr>
            </tbody>

          </table>
        </div>
 
        <div class="row">
          <div class="col-xl-3 text-end">
            <ul class="list-unstyled">
              <li class="text-muted ms-3"><span class="text-black me-4">SubTotal</span>$1110</li>
              <li class="text-muted ms-3 mt-2"><span class="text-black me-4">Tax(15%)</span>$111</li>
            </ul>
            <p class="text-black"><span class="text-black me-3"> Total Amount</span><span
                style="font-size: 25px;">$1221</span></p>
          </div>
        </div>

                </div>

                        </div><!--End InvoiceBot-->
          </div><!--End Invoice-->

        `;

        var originalContent = document.body.innerHTML;
        document.body.innerHTML = printContent;

        // Apply CSS styles to the receipt content
        var style = document.createElement('style');

        document.head.appendChild(style);

        // Print the content
        window.print();

        // Restore the original content
        document.body.innerHTML = originalContent;
    }

    function findClosestTableRow(item) {
        // Find the closest <tr> element by navigating up the DOM hierarchy from the button
        var button = document.querySelector(`[onclick="printReceipt('${item}')"]`);
        if (!button) {
            console.error("Could not find the button associated with the item.");
            return null;
        }

        var tr = button.closest('tr');
        if (!tr) {
            console.error("Could not find the closest table row.");
            return null;
        }

        return tr;
    }


</script>
<script>
    let table = new DataTable('#myTable', {
        responsive: true
    });
    $(document).ready(function () {
        $('#myTable').DataTable();
    });
</script>
